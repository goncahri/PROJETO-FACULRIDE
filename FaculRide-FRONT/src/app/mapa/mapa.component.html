<section class="mapa-section">
  <h2>Planeje sua Carona</h2>

  <!-- Seletor -->
  <div class="tipo-carona">
    <label for="tipoCarona">O que voc√™ procura?</label>
    <select id="tipoCarona" [(ngModel)]="tipoCarona" name="tipoCarona">
      <option value="oferecer">Oferecer carona</option>
      <option value="procurar">Procurar carona</option>
    </select>
  </div>

  <!-- Formul√°rio -->
  <form (ngSubmit)="tracarRota()" class="mapa-form-layout">
    <div class="linha-horizontal">
      <div class="input-group flex2">
        <label>Partida</label>
        <input type="text" [(ngModel)]="origem" name="origem" placeholder="Digite seu ponto de partida" required />
      </div>

      <div class="input-group flex2">
        <label>Destino</label>
        <select [(ngModel)]="destino" name="destino" required>
          <option value="">Selecione o destino</option>
          <option value="FATEC Votorantim">FATEC Votorantim</option>
        </select>
      </div>
    </div>

    <div class="linha-horizontal">
      <div class="input-group">
        <label>Hor√°rio de Entrada na Fatec</label>
        <input type="time" [(ngModel)]="entradaFatec" name="entradaFatec" required />
      </div>

      <div class="input-group">
        <label>Hor√°rio de Sa√≠da da Fatec</label>
        <input type="time" [(ngModel)]="saidaFatec" name="saidaFatec" required />
      </div>

      <div class="input-group">
        <label>Ajuda Mensal</label>
        <input type="number" [(ngModel)]="ajudaCusto" name="ajudaCusto" placeholder="Ajuda dispon√≠vel (R$)" />
      </div>
    </div>

    <div class="botao-centro">
      <button type="submit" class="btn-mapa">Cadastrar Rota</button>
    </div>
  </form>

  <!-- Mapa -->
  <div #mapContainer id="mapa" class="mapa-container"></div>

  <!-- Faixa Caronas Dispon√≠veis -->
  <div class="caronas-disponiveis-faixa">
    <h3 class="titulo-centralizado">Caronas Dispon√≠veis</h3>
    <div class="caronas-disponiveis-lista">
      <div *ngFor="let viagem of viagens" class="carona-card">
        <img [src]="obterFotoUsuario(viagem.usuario?.email, viagem.usuario?.genero)" alt="Foto" class="carona-foto" />

        <div class="carona-info">
          <!-- Bot√£o excluir -->
          <div *ngIf="viagem.idUsuario === meuId" class="excluir-carona">
            <button (click)="excluirCarona(viagem.idViagem)">üóëÔ∏è Excluir Carona</button>
          </div>

          <strong>{{ viagem.usuario?.nome || 'Usu√°rio' }}</strong>
          <p>{{ viagem.tipoUsuario }}</p>
          <p>Partida: {{ viagem.partida }}</p>
          <p>Destino: {{ viagem.destino }}</p>
          <p>Entrada: {{ viagem.horarioEntrada }}</p>
          <p>Sa√≠da: {{ viagem.horarioSaida }}</p>
          <p>Ajuda Mensal: R$ {{ viagem.ajudaDeCusto }}</p>

          <button (click)="mostrarRota(viagem.partida, viagem.destino)">Ver rota</button>
          <a (click)="abrirWhatsapp(viagem.usuario?.nome, viagem.idUsuario, viagem.usuario?.telefone)">
            <img src="assets/whats1.png" class="whatsapp-icon" alt="WhatsApp">
            Entrar em contato
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Box Avalia√ß√£o -->
  <div *ngIf="mostrarAvaliacao" class="avaliacao-box">
    <h3>‚≠ê Avaliar carona com {{ nomeUsuarioSelecionado }}</h3>
    <p class="subtexto-avaliacao">Avalie de 1 a 5 ‚≠ê</p>

    <div class="estrelas">
      <label *ngFor="let nota of [5,4,3,2,1]">
        <input type="radio" name="avaliacao" [value]="nota" [(ngModel)]="avaliacaoSelecionada" />
        <span class="estrela">&#9733;</span>
        <div class="numero-estrela">{{ nota }}</div>
      </label>
    </div>

    <textarea 
      [(ngModel)]="comentarioAvaliacao" 
      name="comentario" 
      rows="3" 
      placeholder="Deixe seu coment√°rio sobre a carona"></textarea>

    <button (click)="enviarAvaliacao()" class="btn-enviar">
      Enviar Avalia√ß√£o
    </button>
  </div>

  <!-- Faixa Minhas Caronas -->
<div class="minhas-caronas-faixa">
  <h3 class="titulo-centralizado">Minhas Caronas</h3>

  <!-- Caronas Oferecidas -->
  <div *ngIf="caronasOferecidas.length > 0">
    <h4 style="color:white;">Caronas Oferecidas</h4>
    <div *ngFor="let c of caronasOferecidas" class="avaliacoes-bloco">
      <p><strong>Partida:</strong> {{ c.partida }}</p>
      <p><strong>Destino:</strong> {{ c.destino }}</p>
      <p><strong>Entrada:</strong> {{ c.entrada }}</p>
      <p><strong>Sa√≠da:</strong> {{ c.saida }}</p>
      <p><strong>Ajuda Mensal:</strong> R$ {{ c.ajuda }}</p>
    </div>
  </div>

  <!-- Caronas Procuradas -->
  <div *ngIf="caronasProcuradas.length > 0">
    <h4 style="color:white;">Caronas Procuradas</h4>
    <div *ngFor="let c of caronasProcuradas" class="avaliacoes-bloco">
      <p><strong>Partida:</strong> {{ c.partida }}</p>
      <p><strong>Destino:</strong> {{ c.destino }}</p>
      <p><strong>Entrada:</strong> {{ c.entrada }}</p>
      <p><strong>Sa√≠da:</strong> {{ c.saida }}</p>
      <p><strong>Ajuda Mensal:</strong> R$ {{ c.ajuda }}</p>
    </div>
  </div>

  <!-- Mensagem caso n√£o tenha caronas -->
  <div *ngIf="caronasOferecidas.length === 0 && caronasProcuradas.length === 0" style="color:white;">
    Voc√™ n√£o tem caronas registradas.
  </div>
</div>

<div class="minhas-caronas-faixa">
  <h3 class="titulo-centralizado">Minhas Avalia√ß√µes</h3>

  <!-- Avalia√ß√µes Recebidas -->
  <div *ngIf="avaliacoesRecebidas.length > 0">
    <h4 style="color:white;">Avalia√ß√µes Recebidas</h4>
    <div *ngFor="let a of avaliacoesRecebidas" class="avaliacoes-bloco">
      <p><strong>De:</strong> {{ a.nomeAvaliador }}</p>
      <p><strong>Nota:</strong> ‚≠ê {{ a.Estrelas }}</p>
      <p><strong>Coment√°rio:</strong> {{ a.Comentario }}</p>
    </div>
  </div>

  <!-- Avalia√ß√µes Enviadas -->
  <div *ngIf="avaliacoesEnviadas.length > 0">
    <h4 style="color:white;">Avalia√ß√µes Enviadas</h4>
    <div *ngFor="let a of avaliacoesEnviadas" class="avaliacoes-bloco">
      <p><strong>Para:</strong> {{ a.nomeAvaliado }}</p>
      <p><strong>Nota:</strong> ‚≠ê {{ a.Estrelas }}</p>
      <p><strong>Coment√°rio:</strong> {{ a.Comentario }}</p>
    </div>
  </div>

  <div *ngIf="avaliacoesRecebidas.length === 0 && avaliacoesEnviadas.length === 0" style="color:white;">
    Voc√™ n√£o tem avalia√ß√µes registradas.
  </div>
</div>

</section>
